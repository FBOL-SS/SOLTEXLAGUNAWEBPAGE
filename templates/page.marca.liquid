{{ page.title }}

<div class="page-marca">
  {% liquid
    # Slug de la marca tomado del handle (con guiones tal cual)
    assign marca_slug = page.handle | downcase
    assign collection_handle = 'machines'

    # URL base de la colección
    assign collection_url = routes.collections_url | append: '/' | append: collection_handle

    # Parámetro de filtro por marca (URL-safe para el valor)
    assign filtro_marca_param = 'filter.p.m.custom.marca=' | append: marca_slug | url_encode
  %}

  <section class="hero" style="text-align: center; padding: 40px 20px;">
    {% assign logo = page.metafields.custom.logo %}
    {% if logo %}
      {{ logo | image_url: width: 200 | image_tag: alt: page.title | default: page.title, loading: 'lazy', width: 200, height: 100 }}
    {% endif %}
    <h1 style="font-size: 2.5rem; margin: 20px 0;">{{ page.title }}</h1>
  </section>

  <section class="history" style="max-width: 800px; margin: 0 auto 40px; padding: 0 20px;">
    {{ page.content }}
  </section>

  <section class="filters" style="padding: 0 20px; margin-bottom: 40px;">
    <h2 style="text-align: center; margin-bottom: 20px;">Filtros por Uso</h2>
    <ul style="list-style: none; padding: 0; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
      {% case marca_slug %}
        {% when 'supreme' %}
          <li><a href="{{ collection_url }}?{{ filtro_marca_param }}&filter.p.m.custom.uso=jeans" class="filter-chip">Jeans</a></li>
          <li><a href="{{ collection_url }}?{{ filtro_marca_param }}&filter.p.m.custom.uso=tejido" class="filter-chip">Tejido</a></li>
          <li><a href="{{ collection_url }}?{{ filtro_marca_param }}&filter.p.m.custom.uso=automatizado" class="filter-chip">Automatizado</a></li>
        {% when 'jack' %}
          <li><a href="{{ collection_url }}?{{ filtro_marca_param }}&filter.p.m.custom.uso=jeans" class="filter-chip">Jeans</a></li>
          <li><a href="{{ collection_url }}?{{ filtro_marca_param }}&filter.p.m.custom.uso=tejido" class="filter-chip">Tejido</a></li>
          <li><a href="{{ collection_url }}?{{ filtro_marca_param }}&filter.p.m.custom.uso=automatizado" class="filter-chip">Automatizado</a></li>
        {% when 'eagle-special' %}
          <li><a href="{{ collection_url }}?{{ filtro_marca_param }}&filter.p.m.custom.uso=cuero" class="filter-chip">Cuero</a></li>
          <li><a href="{{ collection_url }}?{{ filtro_marca_param }}&filter.p.m.custom.uso=pesados" class="filter-chip">Pesados</a></li>
          <li><a href="{{ collection_url }}?{{ filtro_marca_param }}&filter.p.m.custom.uso=industrial" class="filter-chip">Industrial</a></li>
        {% else %}
          {# Marca desconocida: sin chips específicos #}
      {% endcase %}

      <li><a href="{{ collection_url }}?{{ filtro_marca_param }}" class="filter-chip">Ver Todas</a></li>
    </ul>
  </section>

  <section class="products">
    <div class="collection page-width" id="Collection">
      <h2 style="text-align: center; margin-bottom: 40px;">Productos {{ page.title }}</h2>

      {% paginate collections[collection_handle].products by 24 %}
        <ul class="grid product-grid grid--4-col-desktop grid--2-col-tablet-down">
          {% for product in collections[collection_handle].products %}
            {% liquid
              # Normalizamos el metafield de marca del producto para compararlo con el slug de la página:
              # - a minúsculas
              # - espacios -> guiones
              assign prod_marca = product.metafields.custom.marca
              if prod_marca
                assign prod_marca = prod_marca | downcase | replace: ' ', '-'
              endif
            %}

            {% if prod_marca == marca_slug %}
              <li class="grid__item">
                <div class="card-wrapper product-card">
                  <div class="card card--standard">
                    <div class="card__inner">
                      {% if product.featured_media %}
                        <div class="card__media">
                          {{ product.featured_media
                            | image_url: width: 600
                            | image_tag:
                              alt: product.featured_media.alt | default: product.title,
                              loading: 'lazy',
                              widths: '300, 400, 600',
                              sizes: '(min-width: 990px) 25vw, (min-width: 750px) 50vw, 100vw'
                          }}
                        </div>
                      {% endif %}

                      <div class="card__content">
                        <h3 class="card__heading">
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <div class="card-information">
                          <span class="price">
                            {% if product.price_varies %}
                              Desde {{ product.price_min | money }}
                            {% else %}
                              {{ product.price | money }}
                            {% endif %}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            {% endif %}
          {% endfor %}
        </ul>

        {% if paginate.pages > 1 %}
          <nav class="pagination">
            {% if paginate.previous %}
              <a href="{{ paginate.previous.url }}" class="pagination__link">← Anterior</a>
            {% endif %}

            {% for part in paginate.parts %}
              {% if part.is_link %}
                <a href="{{ part.url }}" class="pagination__link">{{ part.title }}</a>
              {% else %}
                <span class="pagination__text">{{ part.title }}</span>
              {% endif %}
            {% endfor %}

            {% if paginate.next %}
              <a href="{{ paginate.next.url }}" class="pagination__link">Siguiente →</a>
            {% endif %}
          </nav>
        {% endif %}
      {% endpaginate %}
    </div>
  </section>
</div>

<style>
.page-marca .filters a:hover { 
  color: #000; 
  border-color: #000; 
}
.product-grid { list-style: none; padding: 0; margin: 0; display: grid; gap: 20px; }
.card { border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; background: #fff; }
.card__media img { width: 100%; height: 200px; object-fit: cover; }
.card__content { padding: 15px; }
.card__heading a { color: #000; text-decoration: none; font-weight: 600; }
.price { color: #6b7280; font-weight: 500; }
.pagination { text-align: center; margin-top: 40px; }
.pagination__link { margin: 0 5px; padding: 8px 12px; border: 1px solid #e5e7eb; text-decoration: none; color: #6b7280; }
.pagination__link:hover { border-color: #000; color: #000; }
.pagination__text { margin: 0 5px; }

/* Chip */
.filter-chip {
  color: #6b7280; text-decoration: none; padding: 8px 16px;
  border: 1px solid #e5e7eb; border-radius: 4px; display: inline-block;
}
.filter-chip:hover { color: #000; border-color: #000; }
</style>
